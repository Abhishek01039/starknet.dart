import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'package:http/testing.dart';
import 'package:starknet_flutter/src/exchange_rates/exchange_rates_repository.dart';

main() {
  const jsonToParse = """
{
  "data": {
    "currency": "USD",
    "rates": {
      "AED": "3.67282",
      "AFN": "88.9002250000003176",
      "ALL": "109.0581379333005758",
      "AMD": "392.5528914999935888",
      "ANG": "1.7961465000000001",
      "AOA": "506.500000000011219",
      "ARS": "196.2842665762788333",
      "AWG": "1.7999999999999999",
      "AZN": "1.6999999999999999",
      "BAM": "1.8524627067855063",
      "BBD": "2",
      "BDT": "106.6482219943246037",
      "BGN": "1.8536450000000001",
      "BHD": "0.3769949994031751",
      "BIF": "2078.1279904795959307",
      "BMD": "1",
      "BND": "1.3494145",
      "BOB": "6.9105466666666658",
      "BRL": "5.1984333333333339",
      "BSD": "1",
      "BTN": "82.8058615000000551",
      "BWP": "13.3169252894446238",
      "BYN": "2.5241194999999009",
      "BYR": "25241.2",
      "BZD": "2.0159195",
      "CAD": "1.3579293333333333",
      "CDF": "2062.3546168346286754",
      "CHF": "0.9408676666666667",
      "CLF": "0.0300968",
      "CLP": "830.7073333333063706",
      "CNY": "6.9526",
      "COP": "4842.2146044261278199",
      "CRC": "560.4789096666666667",
      "CUC": "1",
      "CVE": "104.4384174569291816",
      "CZK": "22.3981990980480117",
      "DJF": "177.8806799144689323",
      "DKK": "7.0522483292676065",
      "DOP": "55.7066576666666667",
      "DZD": "136.9315600000001307",
      "EGP": "30.6310999918383001",
      "ETB": "53.7959473333333333",
      "EUR": "0.9475749989270608",
      "FJD": "2.222085",
      "FKP": "0.8345628184931236",
      "GBP": "0.8345628184931236",
      "GEL": "2.6299999999999998",
      "GHS": "12.8500653331670338",
      "GIP": "0.8345628184931236",
      "GMD": "61.1014",
      "GNF": "8607.963721275069103",
      "GTQ": "7.8154259554965473",
      "GYD": "211.0258449999997724",
      "HKD": "7.847086333312068",
      "HNL": "24.6572936087471588",
      "HRK": "7.1393439957592709",
      "HTG": "150.2766972384242126",
      "HUF": "360.1569550000014957",
      "IDR": "15270.9153808307869256",
      "ILS": "3.671215439870604",
      "INR": "82.7602176666665381",
      "IQD": "1459.4803599998018903",
      "ISK": "144.2824947585460123",
      "JMD": "153.9676184799321044",
      "JOD": "0.7097",
      "JPY": "136.2718586921210465",
      "KES": "126.9666666666666667",
      "KGS": "87.417",
      "KHR": "4042.7022241050831059",
      "KMF": "466.5271765",
      "KRW": "1322.8186415",
      "KWD": "0.3072656666666667",
      "KYD": "0.833333",
      "KZT": "447.3533743333333333",
      "LAK": "16922.9216469942014565",
      "LBP": "15004.76473",
      "LKR": "362.9941782865214056",
      "LRD": "155.7579434999991329",
      "LSL": "18.4196467152294508",
      "LYD": "4.8229084322789865",
      "MAD": "10.4067739950920447",
      "MDL": "18.9133111725780841",
      "MGA": "4289.1686136666010919",
      "MKD": "58.3434705285405799",
      "MMK": "2100.1891706351672831",
      "MNT": "3467.6327472990880672",
      "MOP": "8.0827084946215691",
      "MRO": "357.2139999999954234",
      "MUR": "46.1515899742563948",
      "MVR": "15.3526999999999912",
      "MWK": "1027.1937734999976189",
      "MXN": "18.3653699675584376",
      "MYR": "4.4784999999999996",
      "MZN": "63.864995499999963",
      "NAD": "18.419",
      "NGN": "460.2936793261491894",
      "NIO": "36.544540956054954",
      "NOK": "10.3867916666666721",
      "NPR": "132.5622213333333333",
      "NZD": "1.6271923333333333",
      "OMR": "0.3850144998539016",
      "PAB": "1",
      "PEN": "3.8208346666666667",
      "PGK": "3.5246794344961014",
      "PHP": "55.4630369875693987",
      "PKR": "257.9293053333332026",
      "PLN": "4.4692799989036266",
      "PYG": "7290.0220387859417321",
      "QAR": "3.6489937609324654",
      "RON": "4.660849740390701",
      "RSD": "111.128290495844792",
      "RUB": "74.8698667476552519",
      "RWF": "1089.142938",
      "SAR": "3.7512947032957951",
      "SBD": "8.2452819999995101",
      "SCR": "12.7323291640906208",
      "SDG": "588.0000000000150528",
      "SEK": "10.4794249717311208",
      "SHP": "0.8345628184931236",
      "SKK": "28.5452999999999611",
      "SLL": "18707.5000000169069031",
      "SOS": "568.5043641573354796",
      "SRD": "33.6333999999999559",
      "STD": "22996.3832361802323279",
      "SVC": "8.7500769993224007",
      "SZL": "18.4152942456607752",
      "THB": "35.098844",
      "TJS": "10.4448158868970183",
      "TMT": "3.5100005",
      "TND": "3.1328523982118541",
      "TOP": "2.3601309999999999",
      "TRY": "18.885733333215682",
      "TTD": "6.7884629064281528",
      "TWD": "30.7206666594329901",
      "TZS": "2338.9934999220174393",
      "UAH": "36.7679643333333333",
      "UGX": "3722.5965320661224006",
      "UYU": "38.8868198699664552",
      "UZS": "11350.0336915053293083",
      "VES": "24.3857866666630489",
      "VND": "23819.0193065996743636",
      "VUV": "115.5919999999999168",
      "WST": "2.7145150000000004",
      "XAF": "623.9872903333428756",
      "XAG": "0.04839571",
      "XAU": "0.000552085",
      "XCD": "2.701275",
      "XOF": "622.0372903333333333",
      "XPD": "0.0006878917656636",
      "XPF": "113.0741083507190765",
      "XPT": "0.001060175",
      "YER": "250.3080033708196178",
      "ZAR": "18.4323573182947296",
      "ZMK": "5252.5500000001038954",
      "ZMW": "19.811911700479248",
      "JEP": "0.8345628184931236",
      "GGP": "0.8345628184931236",
      "IMP": "0.8344943250430037",
      "GBX": "327.9269116499314633",
      "CNH": "6.9728799994837144",
      "EEK": "14.8256",
      "LTL": "3.27163",
      "LVL": "0.665928",
      "TMM": "17549.99999998674975",
      "ZWD": "374.7999999999952925",
      "VEF": "2438580",
      "SGD": "1.349806",
      "AUD": "1.4910156666666667",
      "USD": "1.0",
      "BTC": "0.0000425243382735",
      "BCH": "0.0073602473043094",
      "BSV": "0.0237428177976162",
      "ETH": "0.0006067096014828",
      "ETH2": "0.0006067096014828",
      "ETC": "0.0471142520612485",
      "LTC": "0.0105313043020378",
      "ZRX": "3.813228088238098",
      "USDC": "1",
      "BAT": "3.2201970760610549",
      "LOOM": "17.4978127734033246",
      "MANA": "1.5271838729383018",
      "KNC": "1.1348805538217103",
      "LINK": "0.1367147446852143",
      "DNT": "27.5103163686382393",
      "MKR": "0.0012758519501397",
      "CVC": "8.3857442348008386",
      "OMG": "0.5602240896358543",
      "GNT": "5.2330847338986879",
      "DAI": "1.00035012254289",
      "SNT": "32.7761389708292363",
      "ZEC": "0.0225453725622816",
      "XRP": "2.6610436331058416",
      "REP": "0.0988630746416214",
      "XLM": "11.3326004918348613",
      "EOS": "0.8868786306593943",
      "XTZ": "0.8357709987463435",
      "ALGO": "3.9401103230890465",
      "DASH": "0.0136733438162303",
      "ATOM": "0.0778664590227759",
      "OXT": "10.1317122593718338",
      "COMP": "0.0194306810453706",
      "ENJ": "2.0855057351407716",
      "REPV2": "0.0988630746416214",
      "BAND": "0.5015045135406219",
      "NMR": "0.0508130081300813",
      "CGLD": "1.278772378516624",
      "UMA": "0.4528985507246377",
      "LRC": "2.7586206896551724",
      "YFI": "0.0001050116825497",
      "UNI": "0.1529519730804527",
      "BAL": "0.1414427157001414",
      "REN": "10.3039670273055126",
      "WBTC": "0.000042692368611",
      "NU": "6.1792208867552726",
      "YFII": "0.0007575671488582",
      "FIL": "0.1463807362951036",
      "AAVE": "0.0122466474802523",
      "BNT": "2.0999580008399832",
      "GRT": "6.2833804586867735",
      "SNX": "0.3772873042822109",
      "STORJ": "2.2537750732476899",
      "SUSHI": "0.7570882386342128",
      "MATIC": "0.7994883274704189",
      "SKL": "20.5128205128205128",
      "ADA": "2.7502750275027503",
      "ANKR": "23.4109797495025167",
      "CRV": "0.9874105159219946",
      "ICP": "0.1594642002870356",
      "NKN": "8.0710250201775626",
      "OGN": "7.3249340755933197",
      "1INCH": "1.7406440382941688",
      "USDT": "0.9999550020249089",
      "FORTH": "0.2254791431792559",
      "CTSI": "6.0496067755595886",
      "TRB": "0.0546448087431694",
      "POLY": "5.1988562516246426",
      "MIR": "7.6248570339306138",
      "RLC": "0.5244113482615764",
      "DOT": "0.1505683956937439",
      "SOL": "0.0436205016357688",
      "DOGE": "12.3099649165999877",
      "MLN": "0.0388878086719813",
      "GTC": "0.398406374501992",
      "AMP": "165.152766308835673",
      "SHIB": "78802.206461780929866",
      "CHZ": "7.4183976261127596",
      "KEEP": "5.3180174430972134",
      "LPT": "0.1297858533419857",
      "QNT": "0.0077330549433554",
      "BOND": "0.2074688796680498",
      "RLY": "76.0456273764258555",
      "CLV": "12.4300807955251709",
      "FARM": "0.0240153698366955",
      "MASK": "0.2652519893899204",
      "ANT": "0.3683241252302026",
      "FET": "2.2565722667268419",
      "PAX": "1.0039656643742784",
      "ACH": "24.8419431367921599",
      "ASM": "69.3962526023594726",
      "PLA": "3.7509377344336084",
      "RAI": "0.3590664272890485",
      "TRIBE": "3.9132149111019316",
      "ORN": "0.8845643520566121",
      "IOTX": "30.8594352723345163",
      "UST": "33.8983050847457627",
      "QUICK": "0.0097167565466647",
      "AXS": "0.0990589400693413",
      "REQ": "8.8300220750551876",
      "WLUNA": "6112.4694376528117359",
      "TRU": "15.1515151515151515",
      "RAD": "0.4962779156327543",
      "COTI": "11.1919418019026301",
      "DDX": "2.2896393817973669",
      "SUKU": "13.8985406532314107",
      "RGT": "2.5632119365462282",
      "XYO": "175.901495162708883",
      "ZEN": "0.0799360511590727",
      "AST": "8.9726334679228354",
      "AUCTION": "0.1586042823156225",
      "BUSD": "1.0005002501250625",
      "JASMY": "161.6814874696847211",
      "WCFG": "3.0959752321981424",
      "BTRST": "0.9765625",
      "AGLD": "1.677289500167729",
      "AVAX": "0.0549148819330038",
      "FX": "4.7721307563827249",
      "TRAC": "2.6791694574681849",
      "LCX": "9.3984962406015038",
      "ARPA": "23.4466588511137163",
      "BADGER": "0.2702702702702703",
      "KRL": "3.2493907392363932",
      "PERP": "1.0149193139145438",
      "RARI": "0.4878048780487805",
      "DESO": "0.1103143960286817",
      "API3": "0.6297229219143577",
      "NCT": "91.7852225791647545",
      "SHPING": "189.4118761246330145",
      "UPI": "298.9286397551176583",
      "CRO": "12.4921923797626483",
      "MTL": "0.7739938080495356",
      "ABT": "6.8306010928961749",
      "CVX": "0.1701837985023826",
      "AVT": "0.8298755186721992",
      "MDT": "16.28001628001628",
      "VGX": "2.2603978300180832",
      "ALCX": "0.0414593698175788",
      "COVAL": "65.6814449917898194",
      "FOX": "25.8397932816537468",
      "MUSD": "1.0024047971760828",
      "CELR": "48.9835904971834435",
      "GALA": "24.6032722352072826",
      "POWR": "4.8473097430925836",
      "GYEN": "136.4442625187610861",
      "ALICE": "0.5159958720330237",
      "INV": "0.0163412043467604",
      "LQTY": "0.780579189758801",
      "PRO": "2.2045855379188713",
      "SPELL": "1187.8600700837441349",
      "ENS": "0.0611246943765281",
      "DIA": "2.4421217153462929",
      "BLZ": "8.6994345367551109",
      "CTX": "0.4830917874396135",
      "ERN": "0.4434589800443459",
      "IDEX": "16.0513643659711075",
      "MCO2": "0.546448087431694",
      "POLS": "1.8779342723004695",
      "SUPER": "6.4630796574567782",
      "UNFI": "0.1584786053882726",
      "STX": "1.0906909527185472",
      "KSM": "0.0253389078930698",
      "GODS": "3.4957090171814098",
      "IMX": "1.0434601137371524",
      "RBN": "4.3459365493263798",
      "BICO": "2.1048200378867607",
      "GFI": "1.4014434867913951",
      "ATA": "5.5834729201563372",
      "GLM": "3.7174721189591078",
      "MPL": "0.1988071570576541",
      "PLU": "0.1025641025641026",
      "SWFTC": "746.5472191116088093",
      "SAND": "1.4099400775467043",
      "OCEAN": "2.4996875390576178",
      "GNO": "0.0090505928138293",
      "FIDA": "2.0090406830738322",
      "ORCA": "1.1710973181871414",
      "CRPT": "8.6244070720137991",
      "QSP": "61.6712920135676842",
      "RNDR": "0.6755615605472049",
      "NEST": "42.6075841499786962",
      "PRQ": "6.1900340451872485",
      "HOPR": "13.9470013947001395",
      "JUP": "169.104591189650799",
      "MATH": "6.533812479581836",
      "SYN": "0.748502994011976",
      "AIOZ": "26.455026455026455",
      "WAMPL": "0.2107481559536354",
      "AERGO": "7.0896845090393477",
      "INDEX": "0.5",
      "TONE": "61.2369871402327006",
      "HIGH": "0.3418219107844813",
      "GUSD": "1.001001001001001",
      "FLOW": "0.8257638315441784",
      "ROSE": "14.9566257852228537",
      "OP": "0.3362474781439139",
      "APE": "0.1933674949241033",
      "MINA": "1.0548523206751055",
      "MUSE": "0.1482689598932463",
      "SYLO": "437.4453193350831146",
      "CBETH": "0.0006028854095702",
      "DREP": "1.8905378580206069",
      "ELA": "0.7613247049866768",
      "FORT": "6.6379024228343843",
      "ALEPH": "13.67053998632946",
      "DEXT": "4.4974139869574994",
      "FIS": "1.2288031457360531",
      "BIT": "1.6999575010624734",
      "GMT": "2.5451768897938407",
      "GST": "45.0166561627802287",
      "MEDIA": "0.0920810313075506",
      "C98": "3.5391966023712617",
      "00": "7.9333597778659262",
      "ACS": "127.9295875550097226",
      "APT": "0.08",
      "AUDIO": "2.874389192296637",
      "AURORA": "4.1666666666666667",
      "AXL": "1.3710838417769247",
      "BLUR": "1.1693854879260948",
      "BOBA": "3.5106196243637002",
      "DAR": "4.7393364928909953",
      "DYP": "3.5986756873470563",
      "EGLD": "0.0202922077922078",
      "EUROC": "0.9490531472324894",
      "GAL": "0.5148005148005148",
      "GHST": "0.655307994757536",
      "HBAR": "13.7193030594045822",
      "HFT": "1.4055801532082367",
      "ILV": "0.0133466800133467",
      "INJ": "0.266844563042028",
      "KAVA": "1.1565373272422367",
      "LDO": "0.3178134435086604",
      "LIT": "0.7942811755361398",
      "LOKA": "1.7168855695767877",
      "MAGIC": "0.606446526577519",
      "METIS": "0.0295945546019532",
      "MNDE": "16.8321831341524996",
      "MONA": "0.0019496787904193",
      "MSOL": "0.03996003996004",
      "MXC": "36.8731563421828909",
      "NEAR": "0.4273504273504274",
      "OOKI": "196.4057743297652951",
      "PNG": "16.8421052631578947",
      "POND": "84.3525938422606495",
      "PUNDIX": "1.8891092849721356",
      "PYR": "0.2639567110993797",
      "QI": "87.8194432247299552",
      "RARE": "6.0624431645953319",
      "RPL": "0.0206058108386565",
      "STG": "0.9009820704567979",
      "T": "25.1004016064257028",
      "TIME": "0.0190912562046583",
      "VOXEL": "3.4542314335060449",
      "WAXL": "1.3723068478111706",
      "XCN": "108.6366105377512222",
      "XMON": "0.000036112748989"
    }
  }
}
""";

  final clients = [
    MockClient((request) async {
      return http.Response(jsonToParse, 200,
          headers: {'content-type': 'application/json'});
    }),
    null
  ];
  for (final client in clients) {
    group(client == null ? "API" : "MOCK", () {
      test("Get exchange rates for USD", () async {
        final result = await ExchangeRatesRepository(
          client: client,
        ).getExchangeRates(currency: "USD");
        expect(result, isA<Map<String, double>>());
        expect(result.length, greaterThan(0));
        expect(result["ETH"], isA<double>());
      });

      test("Get exchange rate for ETH in USD", () async {
        final result = await ExchangeRatesRepository().getExchangeRate(
          from: "ETH",
          to: "USD",
        );
        expect(result, isA<double>());
        expect(result, greaterThan(0));
      });
    });
  }
}
